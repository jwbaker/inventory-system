{% extends 'uw_inventory_system/base.html' %}

{% block css_includes %}
  <style type='text/css'>
    ul.errorlist li{
      list-style-type: none;
    }
  </style>
{% endblock css_includes %}

{% block navbar_right %}
  <li>
    <button class="btn navbar-btn btn-success" id="pageSave">Save</button>
  </li>
  <li>
    <button class="btn navbar-btn btn-danger" id="pageCancel">Cancel</button>
  </li>
  {{ block.super }}
{% endblock navbar_right %}

{% block content %}
    <div class="row">
    <div class="col-xs-8 col-xs-offset-2">
      <div class="panel panel-default">
        <div class="panel-heading">{% block page_heading %}{% endblock page_heading %}</div>
            {% block page_body %}
            {% endblock page_body %}
        </div>
    </div>
  </div>
{% endblock content %}

{% block modal %}
  <div class="modal fade" id="confirmExitModal" tabindex="-1" role="dialog" aria-labelledby="confirmExitModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Confirm</h4>
          </div>
          <div class="modal-body">
            This page has unsaved changes. Are you sure you want to leave?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-danger pull-left" id="confirmNavigation">Continue</button>
          </div>
        </div>
      </div>
    </div>
{% endblock modal %}

{% block js_includes %}
  <script type="text/javascript">
    {# Redirect on the cancel button #}
    $('#pageCancel').click(function(){
      window.location = {% url 'uw_inventory.views.inventory_list' %};
    });
  </script>

  <script type="text/javascript">
    {# We want to confirm user intent if they try to navigate away with unsaved changes #}
    var pageDirty = false;
    var targetDestination;
    $('.navigate').parent().click(function(event){
      if(pageDirty){
        event.preventDefault();
        event.stopPropagation();
        targetDestination = event.target.href;
        $('#confirmExitModal').modal('show');
      }
    });

    $('#confirmNavigation').click(function(){
      $('#confirmExitModal').modal('hide');
      window.location = targetDestination || {% url 'uw_inventory.views.inventory_list' %};
    });
  </script>
{% endblock js_includes %}