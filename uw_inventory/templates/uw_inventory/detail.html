{% extends 'uw_inventory_system/base.html' %}
{% load uw_inventory_extras %}

{% block content %}
  <div class="row">
    <div class="col-xs-4 col-xs-offset-4 alert alert-warning hidden" id="pageEditWarning" role="alert">This page has unsaved changes</div>
  </div>

  <div class="row">
    <div class="col-xs-8 col-xs-offset-2">
      <div class="panel panel-default">
        <div class="panel-heading">Heading</div>
        <div class="panel-body">
          {% show_editable_field inventory_item.name 'text' 'Name' %}
          {% show_editable_field inventory_item.creation_date 'date' 'Creation Date' %}
          {% show_editable_field inventory_item.status 'dropdown' 'Status' %}
          {% show_editable_field inventory_item.purchase_price 'currency' 'Purchase Price' %}
        </div>
      </div>
    </div>
  </div>
{% endblock content %}

{% block js_includes %}
  {{ block.super }}
  <script type="text/javascript">
    var editClickHandler = function(context){
      var editTarget = context.attr('for');
      var paragraph = $('p#' + editTarget);
      paragraph.toggleClass('hidden');
      paragraph.siblings().toggleClass('hidden');
      editMenuToggle(editTarget);
    }

    var editMenuToggle = function(editTarget){
      $('.save[for="' + editTarget + '"]').toggleClass('hidden');
      $('.cancel[for="' + editTarget + '"]').toggleClass('hidden');
      $('.edit[for="' + editTarget + '"]').toggleClass('hidden');
    }

    $('.edit').click(function(){
      editClickHandler($(this));
    });

    $('.cancel').click(function(){
      editClickHandler($(this));
    });

    $('.save').click(function(){
      var paragraph = $('p#' + $(this).attr('for'));
      var inputControl = paragraph.closest('div').find('.form-control');
      var saveText;

      if(inputControl.is('select')){
        inputControl = inputControl.find('option:selected');
        saveText = (inputControl.hasClass('select-default') ? '' : inputControl[0].text);
      } else {
        saveText = (inputControl[0].value == inputControl.placeholder ? '' : inputControl[0].value);
      }

      paragraph[0].textContent = saveText;

      editClickHandler($(this));

      $('#pageEditWarning').removeClass('hidden');
    });
  </script>
{% endblock js_includes %}