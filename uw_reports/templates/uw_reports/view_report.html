{% extends 'uw_inventory_system/base.html' %}
{% load uw_reports_misc_tags %}
{% load uw_inventory_misc_tags %}

{% block content %}
  <div class="row">
    <h2>
      {{ report.name }}
      <span class="small">
        {% visibility_icon report %}
      </span>
    {% if perms.uw_reports.change_report or report.owner == user %}
      <div class="pull-right">
        <button class="btn btn-default btn-sm" id="edit-report">{% icon 'edit' %} Edit</button>
      </div>
    {% endif %}
    </h2>

  </div>
  {% include 'uw_reports/report_result.html' %}
{% endblock content %}

{% block js_includes %}
  <!-- DataTables -->
  <script src="http://cdn.datatables.net/1.10.4/js/jquery.dataTables.min.js"></script>
  <script src="http://cdn.datatables.net/plug-ins/3cfcc339e89/integration/bootstrap/3/dataTables.bootstrap.js"></script>

  <script type="text/html" id="toolbar-template">
    <div class="btn-group btn-group-sm">
      <button class="btn btn-default" id="export">
        {% icon 'download' %} Export
      </button>
    </div>
  </script>

  <script type="text/javascript">
    $('#query-result').DataTable({
      'dom': '<"row"<"col-xs-2"l><"col-xs-7 toolbar btn-toolbar"><fr>><"row"t><"row"ip>',
      "lengthMenu": [ [10, 25, 50, -1], [10, 25, 50, "All"] ],
    });
    $('.toolbar').append($('#toolbar-template').html());
  </script>

  <script type="text/javascript">
    $('#edit-report').click(function(){
      window.location = '{% url "uw_reports.views.create_report" report.id %}'
    });
    $('.toolbar').on('click', '#export', function(){
      window.location = '{% url "uw_file_io.views.export_options" report.id %}'
    });
    $('table#query-result').on('click', 'tr', function(){
      window.location = $(this).find('td.record-link').text();
    });
  </script>

{% endblock js_includes %}